var meWidgetsJSLoader=function(e,t){var a={loadWidget_ActualiteClasse:function(){window.meWAC=meLib_WActualiteClasse(e)},loadWidget_ActualiteClasse_Ens:function(){window.meWAC.enseignant=meLib_WActualiteClasse_Ens(e)},loadWidget_CahierDeLiaison:function(){window.meWCahierLiaison=meLib_WCahierDeLiaison(e)},loadOptionForm_CahierDeLiaison:function(){window.meWOFCahierLiaison=meLib_WOFCahierDeLiaison(e)},loadWidget_Devoir:function(){window.meWDevoir=meLib_WDevoir(e)},loadWidget_DateTimeWeather:function(){window.meWDateTimeWeather=meLib_WDateTimeWeather(e)},loadOptionForm_DateTimeWeather:function(){window.meWOFDateTimeWeather=meLib_WOFDateTimeWeather(e)},loadWidget_DocPartage:function(){window.meWDocPartage=meLib_WDocPartage(e)},loadWidget_MessageALaClasse:function(){window.meWMALC=meLib_WMessageALaClasse(e)},loadWidget_MessageALaClasse_Ens:function(){window.meWMALC.enseignant=meLib_WMessageALaClasse_Ens(e)},loadWidget_SuiviBlog:function(){window.meWSuiviBlog=meLib_WSuiviBlog(e)},loadWidget_TraitementDeTexte:function(){window.meWTWT=meLib_WTWT(e)},loadWidget_TraitementDeTexte_Ens:function(){window.meWTWT.enseignant=meLib_WTWT_Ens(e)},loadOptionForm_PublicationWidget:function(t){window.meWOFPubWidget=meLib_WOFPubWidget(t,e)},loadWidget_WordOfTheDay:function(){window.meWWOTD=meLib_WWOTD(e)}};return a}(jQuery),meLib_WActualiteClasse=function(e,t){var a={},i=null;function n(e){return e.replace(/\[DQUOT\]/g,'"').replace(/\[SQUOT\]/g,"'")}return a.acDisplayDatas=function(t){if(t){e("#ACTitleViewer").html(MEC_Socle.CommonFunctions.encodeHtmlTags(n(t.Titre))),1==e("#acRTE").length&&(e("#actxtTitle").val(n(t.Titre)),e("#acRTE")[0].innerHTML=n(t.Message),t.HasImage?(e("#acImageContainer").html("<img data-ext='"+t.HasImage+"' src='https://"+document.location.host+"/secure-file/?type=actuclasse&ext="+t.HasImage+"&nocache="+t.NoCache+"' />"),e("#acImageInputContainer").hide(),e("#acImageExistContainer").show()):(e("#acImageContainer").html(""),e("#acImageInputContainer").show(),e("#acImageExistContainer").hide())),t.HasImage?e("#ACImageViewer").html("<img src='https://"+document.location.host+"/secure-file/?type=actuclasse&ext="+t.HasImage+"&nocache="+t.NoCache+"' />"):e("#ACImageViewer").empty();var a=document.createElement("iframe");a.sandbox="allow-popups allow-popups-to-escape-sandbox",a.srcdoc='<html><head><base target="_blank"/></head><body>'+n(t.Message)+"</body></html>",e("#ACTextViewer").empty().append(a),e("#ACTextViewerContainer .acOpenMessage").remove(),e("#ACTextViewerContainer").append("<div class='acOpenMessage meWidgetCreateLine meWidgetLine' onclick='meWAC.acOpenActuInPopin();'>                <div class='iconDebut actionIcons'><i class='fas fa-eye'></i></div><span>Voir l'article complet</span></div>");var i=MEC_Socle.CommonFunctions.encodeHtmlTags(t.Date);if(e("#actxtDate").val(MEC_Socle.CommonFunctions.encodeHtmlTags(i)),i&&10==i.length){var s=new Date(i.substring(6,10),parseInt(i.substring(3,5))-1,i.substring(0,2));e("#ACDateViewer").html(["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"][s.getDay()]+"<span class='month'>"+s.getDate()+" "+["JAN","FEV","MAR","AVR","MAI","JUIN","JUIL","AOU","SEP","OCT","NOV","DEC"][s.getMonth()]+"</span>")}else e("#ACDateViewer").html("")}else e("#actxtTitle").val(""),e("#ACTitleViewer").html(""),e("#ACTextViewer").html("<div class='noPublication'>Aucune publication pour le moment.</div>"),e("#acRTE").val(""),e("#acImageContainer").html(""),e("#acImageInputContainer").show(),e("#acImageExistContainer").hide(),e("#ACImageViewer").empty(),e("#actxtDate").val(""),e("#ACDateViewer").html("");MEUpdateWidgetGrid()},a.acOpenActuInPopin=function(){var t=.8*e(window).width(),a=.8*e(window).height();t>800&&(t=800);var i=e("#ACTextViewerContainer").clone();i.find(".acOpenMessage").remove(),i.find("iframe").attr("style","width: 100%; height: "+a+"px; background-color: #f9f9f9;"),e.fancybox({type:"html",closeBtn:!0,helpers:{overlay:{closeClick:!1,locked:!1}},width:t,height:a,transitionIn:"elastic",transitionOut:"elastic",titleShow:!1,autoSize:!1,content:i[0].outerHTML})},a.init=function(t){i=t,e(function(){i&&(i.Message&&i.Message.length>0||i.HasImage)?a.acDisplayDatas(i):a.acDisplayDatas(null)})},a},meLib_WActualiteClasse_Ens=function(e,t){var a={},i=null,n=null,s=!1,o="",l=null,r=null,c=!1;function d(t){var a=e("#acRTE").val(),n="";if(1==e("#acImageContainer img").length&&(n=e("#acImageContainer img").attr("data-ext")),a&&"<br>"!=a||n){var s={Message:a.replace(/[\"”“]/g,"[DQUOT]").replace(/\’/g,"[SQUOT]"),Date:e("#actxtDate").val(),Titre:e("#actxtTitle").val(),HasImage:n,NoCache:(new Date).getTime()};ajaxSaveWidgetOptions(i,s,function(){t.disabled=!1,MEC_Socle.PopinHelper.openResultPopin("Sauvegarde effectuée.","fa-check"),e(".acEnsHeader .acDelete").add(".ACEnteteViewer").add("#ACTitleViewer").add(".acOpenMessage").show(),meWAC.acDisplayDatas(s)},t)}else MEC_Socle.PopinHelper.openResultPopin("Veuillez saisir un texte ou mettre une image.","fa-exclamation-circle"),t.disabled=!1}function u(e,t,a,i){var n=document.createElement("img");n.src=t,n.onload=function(){a.getContext("2d").drawImage(n,0,0);var t=e,s=t,o=n.width,l=n.height;o>l?o>t&&(l*=t/o,o=t):l>s&&(o*=s/l,l=s),a.width=o,a.height=l,a.getContext("2d").drawImage(n,0,0,o,l),i()}}function p(t,a){var i="image/png",n="png";a&&(i="image/jpeg",n="jpg");for(var s=t.toDataURL(i),o=s.split(","),d=atob(o[1]),u=d.length,p=new Uint8Array(u);u--;)p[u]=d.charCodeAt(u);l=new File([p],"tmpname."+n,{type:i}),e("#acImageContainer").html("<img src='"+s+"' data-ext='"+n+"' />"),e("#acImageInputContainer").hide(),e("#acImageExistContainer").show(),r="upload",c=!1,e.fancybox.update()}function g(t){var a=t.target.files;l=null;var i,n=!1;e.each(a,function(e,t){l=t,n=!0}),n&&((i=new FileReader).onload=function(e){var t=document.createElement("canvas");u(800,e.target.result,t,function(){p(t,"image/jpeg"===l.type)})},i.readAsDataURL(l))}return a.acOpenEditor=function(){n=new nicEditor({iconsPath:o}).panelInstance("acRTE"),r=null,e("#acFileUploadInput").val(null),MEC_Socle.PopinHelper.openGenericHtmlPopin(e("#acTextEditorPopin"),!1,!1,null,!0),s||(s=!0,e.datetimepicker.setLocale("fr"),e("#actxtDate").datetimepicker({format:"d/m/Y",todayButton:!0,timepicker:!1,scrollInput:!1}))},a.acCloseEditor=function(){if(!confirm("Attention, vos modifications ne seront pas sauvegardées. Continuer ?"))return!1;e.fancybox.close(),n.removeInstance("acRTE")},a.acValidMessage=function(e){MEC_Socle.PopinHelper.openLoaderPopin("Sauvegarde de votre message en cours..."),n.removeInstance("acRTE"),e.disabled=!0,c&&a.validCanvasModifs(),"upload"==r&&l?function(e){if(l.size>2097152)alert("L'image redimentionné ne peut dépasser 2 Mo");else{var t=new FormData;t.append("action","meActualiteClasseUploadImage"),t.append("fileUploaded",l),MEC_Socle.AjaxHelper.GenAjaxCallerForFileUpload(t,function(t){d(e)},e)}}(e):"delete"==r?MEC_Socle.AjaxHelper.GenAjaxCaller("meActualiteClasseDeleteImage",{},function(){d(e)},e):d(e)},a.acRemove=function(t){t.disabled=!0,MEC_Socle.PopinHelper.openLoaderPopin("Suppression en cours"),1==e("#ACImageViewer img").length?MEC_Socle.AjaxHelper.GenAjaxCaller("meActualiteClasseDeleteImage",{},function(){e("#ACImageViewer").empty(),a.acRemove(t)},t):ajaxSaveWidgetOptions(i,null,function(){meWAC.acDisplayDatas(null),e(".acEnsHeader .acDelete").add(".ACEnteteViewer").add("#ACTitleViewer").add(".acOpenMessage").hide(),t.disabled=!1})},a.deleteImage=function(){e("#acImageContainer").html(""),e("#acFileUploadInput").val(null),e("#acImageInputContainer").show(),e("#acImageExistContainer").hide(),r="delete",e.fancybox.update()},a.replaceImage=function(){e("#acFileUploadInput").trigger("click")},a.addFlouToImage=function(){var t=e("#acImageContainer img"),a=t.offset();if(1==t.length){c=!0;var i=t[0],n=document.createElement("canvas");u(800,t[0].src,n,function(){var s=e("<div>",{class:"canvasFlouContainer"});s.append(n),e("#acImageContainer").append(s),e("#acImgActions").hide(),e("#acImgEditCanvasActions").show();var o=n.getContext("2d"),l={},r=!1;o.clearRect(0,0,n.width,n.height),n.addEventListener("mousedown",function(e){a=t.offset(),l.startX=e.pageX-a.left,l.startY=e.pageY-a.top,r=!0},!1),n.addEventListener("mouseup",function(){r=!1,n.width=i.width,n.height=i.height,o.drawImage(i,0,0,n.width,n.height),o.filter="blur(10px)",o.drawImage(n,l.startX,l.startY,l.w,l.h,l.startX,l.startY,l.w,l.h),o.filter="none",o.fillStyle="rgba(255,255,255,0.2)",o.fillRect(l.startX,l.startY,l.w,l.h)},!1),n.addEventListener("mousemove",function(e){r&&(l.w=e.pageX-a.left-l.startX,l.h=e.pageY-a.top-l.startY,o.fillStyle="rgba(255,255,255,0.2)",o.clearRect(0,0,n.width,n.height),o.fillRect(l.startX,l.startY,l.w,l.h))},!1),n.addEventListener("touchstart",function(e){e.preventDefault(),l=function(e,t){var a=e.getBoundingClientRect();return{startX:t.touches[0].clientX-a.left,startY:t.touches[0].clientY-a.top}}(n,e);var t=e.touches[0],a=new MouseEvent("mousedown",{clientX:t.clientX,clientY:t.clientY});n.dispatchEvent(a)},!1),n.addEventListener("touchend",function(e){e.preventDefault();var t=new MouseEvent("mouseup",{});n.dispatchEvent(t)},!1),n.addEventListener("touchmove",function(e){e.preventDefault();var t=e.touches[0],a=new MouseEvent("mousemove",{clientX:t.clientX,clientY:t.clientY});n.dispatchEvent(a)},!1)})}},a.validCanvasModifs=function(){p(e("#acImageContainer canvas")[0],"jpg"===e("#acImageContainer img").attr("data-ext")),e("#acImgActions").show(),e("#acImgEditCanvasActions").hide()},a.cancelCanvasModifs=function(){e("#acImageContainer canvas").remove(),e("#acImgActions").show(),e("#acImgEditCanvasActions").hide(),c=!1},a.init=function(t){i=t.wid,o=t.iconPathNiceEdit,e(function(){e("#acFileUploadInput").on("change",g)})},a},meLib_WCahierDeLiaison=function(e,t){var a,i,n,s,o,l,r,c,d,u={},p=null,g=!1,m=null,f=new Array,v="-1",h="-1",w="-1",C=-1,T=new Array,E=!1,x=null,b=null;function M(){var t=0,a=0,i=0,n=0;if(g)m.forEach(function(e){"1"==e.msgEleveSens&&null==e.msgEleveReaded?i++:"2"==e.msgEleveSens&&null==e.msgEleveReaded&&t++,"1"==e.msgParentSens&&null==e.msgParentReaded?n++:"2"==e.msgParentSens&&null==e.msgParentReaded&&a++}),p.forEleve&&(e("#wclNbNewMsgEleve").html(t),e("#wclNbNotReadMsgEleve").html(i)),p.forParent&&(e("#wclNbNewMsgParent").html(a),e("#wclNbNotReadMsgEns").html(n));else if(1==m.length){var s=m[0];p.forEleve&&D(c,s.msgEleveSens,s.msgEleveReaded),p.forParent&&D(d,s.msgParentSens,s.msgParentReaded)}}function L(e,t,a){var i=l.clone();i.attr("data-id",e.id),i.attr("data-index",t);var n=e.content;if(n&&(n=n.replace(/(?:\r\n|\r|\n)/g,"<br/>")),i.find(".wclConversText").html(n),("1"==e.sens&&g||"2"==e.sens&&!g)&&i.addClass("wclMsgFromUser"),e.sendDate&&e.sendDate!=b){var s=new Date(1e3*e.sendDate+1e3*(new Date).getTimezoneOffset());if(s.toLocaleDateString()!=b){var o=MEC_Socle.CommonFunctions.formatDateToText(s);"1"==e.sens&&(o="Enseignant - "+o),i.find(".wclDateMsg").html(o),b=s.toLocaleDateString()}}g||("1"==w&&e.id>0&&"1"==e.sens?null==e.readDate&&t==T.length-1?i.find(".wclConversLineAction").html("<span>marquer comme lu</span>").attr("onclick","meWCahierLiaison.sendReadNotification("+t+", this);"):t==T.length-1?i.find(".wclConversLineAction").html("<i class='fas fa-check'></i>").removeAttr("onclick"):i.find(".wclConversLineAction").remove():i.find(".wclConversLineAction").remove()),t==T.length-1&&e.readDate&&("1"==e.sens&&g||"2"==e.sens&&!g)&&i.find(".wclConversReadStatus").html("<i class='fas fa-check'></i>Lu"),e.id<0&&(i.find(".wclConversReadStatus").html("<i class='fas fa-spinner fa-spin'></i>envoi en cours"),i.find(".wclConversLineAction").hide()),r.append(i),r[0].scrollTop=r[0].scrollHeight,a&&MEUpdateWidgetGrid()}function y(e,t){"1"===w?(m[v].msgParentSens=e,m[v].msgParentReaded=t):(m[v].msgEleveSens=e,m[v].msgEleveReaded=t),M()}function W(e,t,a){null==t?e.attr("class","fas fa-paper-plane").parent().tooltipster("content","Envoyer un message"):"1"===t&&null==a?e.attr("class","fas fa-clock").parent().tooltipster("content","En attente de lecture"):"2"===t&&null==a?e.attr("class","fas fa-envelope-open-text").parent().tooltipster("content","Message reçu !"):e.attr("class","fas fa-check").parent().tooltipster("content","Pas de nouveau message")}function D(e,t,a){e.removeClass("wclHasNewMsg"),"1"===t&&null==a?(e.addClass("wclHasNewMsg"),e.find(".wclMsgStatus span").html("Message reçu !"),e.find(".wclMsgStatus i").attr("class","fas fa-envelope-open-text")):"2"===t&&null==a?(e.find(".wclMsgStatus span").html("Message envoyé"),e.find(".wclMsgStatus i").attr("class","far fa-envelope-open")):(e.find(".wclMsgStatus span").html("Aucun message"),e.find(".wclMsgStatus i").attr("class","far fa-envelope-open"))}return u.messagesLoaded=function(e){m=e,M(),i.show().siblings(".wclPanel").hide(),MEUpdateWidgetGrid()},u.goToListEleve=function(){g?(a.show().siblings(".wclPanel").hide(),m.forEach(function(e,t){var a=o.find("tr[data-eleveid='"+e.eleveID+"']");a.attr("data-indexmsgstatus",t),p.forEleve&&W(a.find("a[data-parent='0'] i"),e.msgEleveSens,e.msgEleveReaded),p.forParent&&W(a.find("a[data-parent='1'] i"),e.msgParentSens,e.msgParentReaded)}),n.show().siblings(".wclPanel").hide(),MEUpdateWidgetGrid()):u.returnToHome()},u.expandGroupEleve=function(t,a){e(t).hasClass("groupEleveExpended")?(e(t).removeClass("groupEleveExpended"),o.slideUp(200,MEUpdateWidgetGrid)):(e(t).addClass("groupEleveExpended").siblings().removeClass("groupEleveExpended"),o.slideUp(200,function(){o.find("tr").not(".wclHeaderLine").hide(),o.find("tr[data-nivoid='"+a+"']").show(),o.detach().insertAfter(e(t)),o.slideDown(200,MEUpdateWidgetGrid)}))},u.returnToHome=function(){i.show().siblings(".wclPanel").hide(),e("#wclParentNotifHidder").hide(),MEUpdateWidgetGrid()},u.openConverse=function(t){var i="";g?(h=e(t).parents("tr").attr("data-eleveid"),v=e(t).parents("tr").attr("data-indexmsgstatus"),i=e(t).parents("tr").find(".wclCellEleveName").text()):(h="-1",v=0,i=c.find(".wclBlockHomeTitleCont span").text()),E=!1,w=e(t).attr("data-parent"),a.show().siblings(".wclPanel").hide(),f=new Array,MEC_Socle.AjaxHelper.GenAjaxCaller("meCahierLiaisonLoadConverse",{eleveID:h,withParent:w},function(t){if("1"==w&&(i="Parents de "+i,g||e("#wclParentNotifHidder").show()),e("#wclCorrespondant").html(i).attr("title",i),r.empty(),b=null,e("#wclMessageInput").val(""),t.msgs&&t.msgs.length>0){var a=t.msgs.length;(T=t.msgs).forEach(function(e,t){L(e,t,!1),t===a-1&&(y(e.sens,e.readDate),function(e,t,a){(g&&"2"==t&&null==a||!g&&"1"==t&&"0"==w&&null==a)&&u.sendReadNotification(e)}(t,e.sens,e.readDate))})}else T=new Array;s.show().siblings(".wclPanel").hide(),r[0].scrollTop=r[0].scrollHeight,MEUpdateWidgetGrid()})},u.inputKeyPress=function(e){return!(13==e.keyCode&&!event.shiftKey)||(u.sendMessage(),!1)},u.sendMessage=function(){var t=e("#wclMessageInput"),a=t.val(),i="meCahierLiaisonInsertMessage";if(a&&""!=a.trim()){if(E)return void MEC_Socle.PopinHelper.openHrefPopin("#wclPopinConfirmMsgSend",!1,!1);t.val(""),t.removeAttr("style");var n={id:C,content:a,sens:g?"1":"2",readDate:null,sendDate:null};if(T.push(n),L(n,T.length-1,!0),f.push({id:C,date:(new Date).getTime()}),f.length>20){for(var s=0,o=f.length-1;o>1&&o>f.length-20;o--)s+=f[o].date-f[o-1].date;s<4e4&&(i="meDeconnectAjax")}MEC_Socle.AjaxHelper.GenAjaxCaller(i,{eleveID:h,withParent:w,message:a,tmptableindex:f.length-1},function(t){var a,n,s;"meDeconnectAjax"==i?document.location.href="/identification":(a=f[t.tmptableindex].id,n=t.msgID,(s=e(".wclConversLine[data-id='"+a+"']",r)).attr("data-id",n),s.find(".wclConversReadStatus").html("<i class='fas fa-check'></i>Envoyé"),setTimeout(function(){s.find(".wclConversReadStatus").fadeOut(200,function(){s.find(".wclConversReadStatus").html("").show()})},2e3),s.find(".wclConversLineAction").show(),y(g?"1":"2",null),g||s.siblings().find(".wclConversLineAction").hide())}),C--}else alert("Veuillez saisir un message")},u.sendMessageCollectif=function(){var t=e("#wclMessageInput"),i=t.val();MEC_Socle.PopinHelper.openLoaderPopin("Envoi du message en cours"),x&&E&&(i&&""!=i.trim()?(t.val(""),t.removeAttr("style"),MEC_Socle.AjaxHelper.GenAjaxCaller("meCahierLiaisonSendCollectifMessage",{message:i,groups:x},function(t){e.fancybox.close(),a.show().siblings(".wclPanel").hide(),MEC_Socle.AjaxHelper.GenAjaxCaller("meCahierLiaisonLoadMsgsStatusAjax",{},function(e){meWCahierLiaison.messagesLoaded(e.msgStatusListEleve)})})):alert("Veuillez saisir un message"))},u.deleteMsg=function(t){var a=e(t).parents(".wclConversLine").attr("data-id"),i=e(t).parents(".wclConversLine").attr("data-index");a>0&&!e(t)[0].disabled&&(e(t).addClass("disabled")[0].disabled=!0,MEC_Socle.AjaxHelper.GenAjaxCaller("meCahierLiaisonDeleteMsg",{eleID:h,isParent:w,msgID:a},function(){e(t).parents(".wclConversLine").fadeOut(300),e(t).remove(),T.splice(i,1),T.length>0?y(T[T.length-1].sens,T[T.length-1].readDate):y(null,null),MEUpdateWidgetGrid()},e(t)[0]))},u.sendReadNotification=function(t,a){if(a){if(a.disabled)return;a.disabled=!0,e(a).addClass("wclDisabled")}MEC_Socle.AjaxHelper.GenAjaxCaller("meCahierLiaisonNotifyReadMsg",{eleID:h,isParent:w,msgID:T[t].id},function(){T[t].readDate=new Date,y(T[t].sens,T[t].readDate),a&&e(a).removeAttr("onclick").html("<i class='fas fa-check'></i>")},a)},u.autoGrow=function(e){var t=0;e.style.height&&(t=parseInt(e.style.height.substring(0,e.style.height.length-2))),e.style.height="5px",e.scrollHeight>150?e.style.height="150px":e.scrollHeight<48?e.style.height="48px":e.style.height=e.scrollHeight+5+"px",t<parseInt(e.style.height.substring(0,e.style.height.length-2))-5&&MEUpdateWidgetGrid()},u.openCollectiveConvers=function(){g&&MEGroupSelectorPopin.open("Envoyer un message au(x) groupe(s) suivant :",null,!1,function(t,i){h="-99",v=0,E=!0,x=t,w="1",f=new Array,a.show().siblings(".wclPanel").hide(),e("#wclCorrespondant").html("Parents des "+i).attr("title","Parents des "+i),r.empty(),b=null,e("#wclMessageInput").val(""),s.show().siblings(".wclPanel").hide()},!0)},u.init=function(t){p=t.Options,g=t.isEnseignant,e(function(){a=e("#wclLoader"),s=e("#wclDiscussionPanel"),r=e("#wclConversationContainer"),(l=e("#wclConversLineTplt").clone(!0)).removeAttr("id").removeAttr("style"),e("#wclConversLineTplt").remove(),g?(i=e("#wclHomeStats"),n=e("#wclListEleves"),o=e("#wclGroupElevesContent"),p.forEleve||(e(".wclColEleve").addClass("wclDisabled"),e("#wclNbNewMsgEleve").html("-"),e("#wclNbNotReadMsgEleve").html("-"),e("#wclTableListEleves .wclCellEleveStatus").html("-"),e("#lnkMsgCollectif").show()),p.forParent||(e(".wclColParent").addClass("wclDisabled"),e("#wclNbNewMsgParent").html("-"),e("#wclNbNotReadMsgEns").html("-"),e("#wclTableListEleves .wclCellParentStatus").html("-"),e("#lnkMsgCollectif").hide())):(i=e("#wclHomeStudent"),c=e("#wclBlockHomeStudent"),d=e("#wclBlockHomeParent"),p.forEleve||c.hide(),p.forParent||d.hide()),window.MEWAjaxQueue.push({function:"MECahierLiaisonLoadMsgsStatus",params:{},callback:function(e){meWCahierLiaison.messagesLoaded(e.msgStatusListEleve)}}),MEWebNotification.buildNotificationSubscribeLink(e("#wclNotifToggler"),1,g,e)})},u},meLib_WOFCahierDeLiaison=function(e,t){var a={saveData:function(){e("#wofclchkEleves").is(":checked")||e("#wofclchkParents").is(":checked")?(options={forEleve:e("#wofclchkEleves").is(":checked"),forParent:e("#wofclchkParents").is(":checked")},parent.ME_PageManageWidget.widgetsList.forEach(function(e){"MEWidgetCahierDeLiaison"==e.className&&(e.options=JSON.stringify(options))}),parent.jQuery.fancybox.close()):alert("Veuillez sélectionner au moins une des options")}};return e(function(){if(parent.ME_PageManageWidget.widgetsList[parent.ME_PageManageWidget.currentEditedIndex].options&&parent.ME_PageManageWidget.widgetsList[parent.ME_PageManageWidget.currentEditedIndex].options.length>0){var t=JSON.parse(parent.ME_PageManageWidget.widgetsList[parent.ME_PageManageWidget.currentEditedIndex].options.replace(/\\/g,""));e("#wofclchkEleves").prop("checked",t.forEleve),e("#wofclchkParents").prop("checked",t.forParent)}e("#wofclchkEleves").add("#wofclchkParents").bootstrapToggle({on:"Activé",off:"Désactivé",width:"120px"})}),a},meLib_WDevoir=function(e,t){var a=!1,i=null,n=null,s=null,o=!1,l=!1,r=null;function c(t){if(-1==t&&(s=JSON.parse(JSON.stringify(i))),s.id=t,e("#devwHome").hide(),e("#devwEdit").attr("data-devid",t).show(),-1==t)e("#devwTitle").add("#devwDate").add("#devwDescription").val(""),e("#devwEdit .meWidgetSubHeaderTitle").html("Création"),0==e("#devwEdit .actionIcons .fa-trash").length&&e("#devwEdit .actionIcons .fa-trash").remove(),MEGroupSelectorPopin.updateIconAndTitle(e("#devwEdit .devwGroups i"),!0,null);else{e("#devwEdit .meWidgetSubHeaderTitle").html("Edition"),0==e("#devwEdit .actionIcons .fa-trash").length&&e("#devwEdit .meWidgetSubHeaderTitle").after("<div class='actionIcons'><i class='fas fa-trash' onclick='meWDevoir.devwDeleteDevoir(this)'></i></div>"),e("#devwCateg").val(s.categ),e("#devwTitle").val(s.titre);var n=new Date(s.date.substring(0,4),parseInt(s.date.substring(5,7))-1,s.date.substring(8,10));e("#devwDate").val(n.dateFormat("d/m/Y")),e("#devwDescription").val(s.description),MEGroupSelectorPopin.updateIconAndTitle(e("#devwEdit .devwGroups i"),!0,s.groupExcluded)}e("#devwTitle").removeClass("error"),e("#devwDate").removeClass("error"),a||(a=!0,e.datetimepicker.setLocale("fr"),e("#devwDate").datetimepicker({format:"d/m/Y",todayButton:!0,timepicker:!1,minDate:"+1970/01/01",scrollInput:!1})),MEUpdateWidgetGrid()}function d(){e("#devwHome").show(),e("#devwEdit").add("#devwView").hide(),MEUpdateWidgetGrid()}function u(){if(e("#devwDevoirList").empty(),n&&n.length>0)for(var t=null,a=0;a<n.length;a++){var i=e("#devwDevoirLineTplt").clone();i.removeAttr("id").attr("data-devindex",a);var s=p(MEC_Socle.CommonFunctions.encodeHtmlTags(n[a].categ));i.attr("style","color: "+s.color),o&&i.attr("onclick","meWDevoir.devwEditDevoir(this);"),n[a].date!=t?i.children(".devwDate").html(MEFormatDateForFullTextDisplay(n[a].date)):i.children(".devwDate").remove(),t=n[a].date,i.children(".devwCateg").html("<i class='fas "+s.icon+"'></i>"),i.children(".devwTitle").html(MEC_Socle.CommonFunctions.encodeHtmlTags(n[a].titre)),l&&i.children(".devwDesc").html(MEC_Socle.CommonFunctions.encodeHtmlTags(n[a].description)),e("#devwDevoirList").append(i)}MEUpdateWidgetGrid()}function p(e){return e==r.DEVOIR?{icon:"fa-briefcase",color:"#446fad"}:e==r.ANNIVERSAIRE?{icon:"fa-birthday-cake",color:"#ffd42a"}:e==r.SORTIE?{icon:"fa-bus",color:"#8BC34A"}:e==r.DIVERS?{icon:"fa-info-circle",color:"#a4a9b1"}:e==r.SIGNATURE?{icon:"fa-pencil-alt",color:"#f37864"}:void 0}return{init:function(t,a,n,s){i=t,o=a,r=n,l=s,e(document).ready(function(){window.MEWAjaxQueue.push({function:"MELoadDevoir",params:{dateLocale:MEC_Socle.CommonFunctions.getLocalDateToSQLFormat(!1,!0)},callback:function(e){meWDevoir.devwDevoirsLoaded(e.devoirList)}})})},devwCreateDevoir:c,devwPrevClick:d,devwSaveDevoir:function(t){s.categ=e("#devwCateg").val(),s.titre=e("#devwTitle").val(),s.date=e("#devwDate").val(),s.titre||e("#devwTitle").addClass("error"),s.categ?s.date?(t.disabled=!0,s.description=e("#devwDescription").val(),MEC_Socle.PopinHelper.openLoaderPopin("Enregistrement en cours..."),e.post(MyAjaxVars.ajaxurl,{action:"meSaveDevoir",security:MyAjaxVars.postCommentNonce,devoir:s},function(t){if(t.success){e.fancybox.close();var a=0;if(-1!=s.id)for(var i=0;i<n.length;i++)if(s.id==n[i].id){n.splice(i,1);break}for(a=0;a<n.length&&!(new Date(t.devoir.date)-new Date(n[a].date)<0);a++);n.splice(a,0,t.devoir),d(),u()}})):e("#devwDate").addClass("error"):e("#devwCateg").addClass("error")},devwEditDevoir:function(t){var a=e(t).attr("data-devindex");c((s=n.slice(a,a+1)[0]).id)},devwOpenDevoir:function(t){var a=e(t).attr("data-devindex"),i=n.slice(a,a+1)[0],s=p(i.categ),o=i.description;o&&(o=(o=MEC_Socle.CommonFunctions.encodeHtmlTags(o)).replace(/(?:\r\n|\r|\n)/g,"<br/>")),e("#devwView #devwViewTitle").html(MEC_Socle.CommonFunctions.encodeHtmlTags(i.titre)),e("#devwViewCategIcon").html("<i class='fas "+s.icon+"'></i>"),e("#devwViewDate .devwViewValue").html(MEFormatDateForFullTextDisplay(i.date)),e("#devwViewDesc .devwViewValue").html(o),e("#devwHome").hide(),e("#devwView").show().attr("class",MEC_Socle.CommonFunctions.encodeHtmlTags(i.categ)),MEUpdateWidgetGrid()},devwDeleteDevoir:function(t){var a=e(t).parents("#devwEdit").attr("data-devid");MEC_Socle.PopinHelper.openLoaderPopin("Suppression en cours..."),e.post(MyAjaxVars.ajaxurl,{action:"meDeleteDevoir",security:MyAjaxVars.postCommentNonce,idToDelete:a},function(t){if(e.fancybox.close(),t.success){for(var i=0;i<n.length;i++)if(a==n[i].id){n.splice(i,1);break}d(),u()}})},devwDevoirsLoaded:function(e){n=e,u()},devwOpenGroupSelector:function(){MEGroupSelectorPopin.open("Afficher au(x) groupe(s)",s.groupExcluded,!0,function(t){s.groupExcluded=t,MEGroupSelectorPopin.updateIconAndTitle(e("#devwEdit .devwGroups i"),!0,t),jQuery.fancybox.close()},!1)}}},meLib_WDateTimeWeather=function(e,t){var a={},i=null;function n(){var e=new Date,t="<div class='dtwwHour'>"+(1==e.getHours().toString().length?"0":"")+e.getHours()+"h"+(1==e.getMinutes().toString().length?"0":"")+e.getMinutes()+"</div>",a="<div class='dtwwDay'>"+["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"][e.getDay()]+" "+e.getDate()+" "+["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"][e.getMonth()]+"</div>";document.getElementById("dtwwDateAndTime").innerHTML=t+a,setTimeout(n,1e3)}return a.init=function(t){i=t,n(),e(function(){window.curOWMAPP=new window.OWMGenerator,window.curOWMAPP.listOfCities=i.CityCode,window.curOWMAPP.unitsSystem=i.Celsius?"metric":"imperial",window.curOWMAPP.GetWeather()})},a},meLib_WOFDateTimeWeather=function(e,t){var a={},i=null,n=null;return a.selectCity=function(t,a){e("#cityNameSelected").html(a),e("#cityCodeSelected").html(t),e("#dtwwCitySearch").hide(),e("#dtwwCitySelected").show(),checkContentInput()},a.displayCitySearch=function(){e("#txtCitySearchName").val(""),e("#dtwwCityPropal").html("<i>Commencez à saisir le nom de la ville recherchée pour lancer la recherche</i>"),e("#dtwwCitySearch").show(),e("#dtwwCitySelected").hide(),parent.jQuery.fancybox.update()},a.saveData=function(){""==e("#cityCodeSelected").html()?e("#txtCitySearchNameError").html("Veuillez sélectionner une ville"):(options={CityCode:e("#cityCodeSelected").html(),CityName:e("#cityNameSelected").html(),Celsius:e("#chkCelsius").is(":checked")},parent.ME_PageManageWidget.widgetsList[parent.ME_PageManageWidget.currentEditedIndex].options=JSON.stringify(options),parent.jQuery.fancybox.close())},e(function(){if(initYokoInputs(),e("#txtCitySearchName").keydown(function(){i=new Date,e("#dtwwCityPropal").html("<i class='fas fa-spinner fa-spin'></i>"),null==n&&(n=setInterval(function(){var t=new Date,a=e("#txtCitySearchName").val();null!=i&&t.getTime()-i.getTime()>1e3&&a.length>2&&(e.post(MyAjaxVars.ajaxurl,{action:"meSearchCity",security:MyAjaxVars.postCommentNonce,cityName:a},function(t){t.success?e("#dtwwCityPropal").html(t.listOfCities):e("#dtwwCityPropal").html("<i>Aucun résultat... Veuillez rechercher une ville plus importante à proximité.</i>"),parent.jQuery.fancybox.update()}),i=null)},1e3))}),parent.ME_PageManageWidget.widgetsList[parent.ME_PageManageWidget.currentEditedIndex].options&&parent.ME_PageManageWidget.widgetsList[parent.ME_PageManageWidget.currentEditedIndex].options.length>0){var t=JSON.parse(parent.ME_PageManageWidget.widgetsList[parent.ME_PageManageWidget.currentEditedIndex].options.replace(/\\/g,""));t.CityCode&&(a.selectCity(t.CityCode,t.CityName),t.Celsius?e("#chkCelsius").prop("checked",!0):e("#chkCelsius").prop("checked",!1))}e("#chkCelsius").bootstrapToggle({off:"Fahrenheit",on:"Celsius",width:"130px"}),parent.jQuery.fancybox.update()}),a},meLib_WDocPartage=function(e,t){var a={},i=null,n=!1,s=!0;function o(t){var a=t.target.files;i=null;var s=!1;e.each(a,function(e,t){i=t,s=!0}),s?(e("#wpdFileUploadPart .noFileZone").hide(),e("#wpdFileUploadPart .withFileZone").show(),n&&(e("#wpdFileDisplay").empty().add("#wpdFileEditPart").hide(),e("#wpdFileUploadPart").show())):(e("#wpdFileUploadPart .noFileZone").show(),e("#wpdFileUploadPart .withFileZone").hide())}return a.init=function(t){s=t,e(function(){s||(e("#wpdFileUploadInput").on("change",o),e("#wpdFileUploaderLink").click(function(t){n=!1,e("#wpdFileUploadInput").click()}),e("#wpdSend").click(function(){!function(t){if(i)if(i.size>10485760)alert("Le fichier ne peut dépasser 10 Mo");else{t.disabled=!0,MEC_Socle.PopinHelper.openLoaderPopin("Téléversement du document en cours...");var a=new FormData;a.append("action","meDocPartageUploadFile"),e("#wpdFileTitle").val()?a.append("docTitle",e("#wpdFileTitle").val()):a.append("docTitle",i.name),a.append("fileUploaded",i),a.append("overrideFile",n),MEC_Socle.AjaxHelper.GenAjaxCallerForFileUpload(a,function(t){var a='<a id="wpdFileOpenLink" target="blank" data-file-id="'+t.fileid+'" href="/secure-file?type=docpartage&id='+t.fileid+'">                            <i class="far fa-file-download"></i><span>'+t.filename+"</span>                        </a>";e("#wpdFileDisplay").html(a).add("#wpdFileEditPart").show(),e("#wpdFileUploadPart").hide(),e.fancybox.close()},t)}}(this)}),e("#wpdFileRemoveLink").click(function(){var t;(t=this).disabled=!0,MEC_Socle.PopinHelper.openLoaderPopin("Suppression du fichier en cours"),MEC_Socle.AjaxHelper.GenAjaxCaller("meDocPartageDeleteFile",{fileid:e("#wpdFileOpenLink").attr("data-file-id")},function(){e("#wpdFileDisplay").empty().add("#wpdFileEditPart").hide(),s||(e("#wpdFileUploadPart").show(),e("#wpdFileTitle").val(null),e("#wpdFileUploadInput").val(null).change()),e.fancybox.close()},t)}),e("#wpdFileReplaceLink").click(function(){n=!0,e("#wpdFileTitle").val(null),e("#wpdFileUploadInput").val(null),e("#wpdFileUploadInput").click()})),1==e("#wpdFileOpenLink").length?(e("#wpdFileDisplay").show(),s||(e("#wpdFileUploadPart").hide(),e("#wpdFileEditPart").show())):s&&MEWidgetGrid&&MEWidgetGrid.masonry("remove",e(".meWidget.MEWidgetDocsPartages"))})},a},meLib_WMessageALaClasse=function(e,t){var a={},i=null;function n(e){return e.replace(/\[DQUOT\]/g,'"').replace(/\[SQUOT\]/g,"'")}return a.malcDisplayDatas=function(t){if(t){e("#MALCTitleViewer").html(MEC_Socle.CommonFunctions.encodeHtmlTags(n(t.Titre))),1==e("#malcRTE").length&&(e("#malctxtTitle").val(n(t.Titre)),e("#malcRTE")[0].innerHTML=n(t.Message));var a=document.createElement("iframe");a.sandbox="allow-popups allow-popups-to-escape-sandbox",a.srcdoc='<html><head><base target="_blank"/></head><body>'+n(t.Message)+"</body></html>",e("#MALCTextViewer").empty().append(a),e("#MALCTextViewerContainer .malcOpenMessage").remove(),e("#MALCTextViewerContainer").append("<div class='malcOpenMessage meWidgetCreateLine meWidgetLine' onclick='meWMALC.malcOpenMessageInPopin();'>                <div class='iconDebut actionIcons'><i class='fas fa-eye'></i></div><span>Voir le message complet</span></div>"),e("#malcIconSelected").add("#MALCIconViewer i").attr("class",""!=t.Icon?MEC_Socle.CommonFunctions.encodeHtmlTags(t.Icon):"fas fa-envelope");var i=MEC_Socle.CommonFunctions.encodeHtmlTags(t.Date);if(e("#malctxtDate").val(MEC_Socle.CommonFunctions.encodeHtmlTags(i)),i&&10==i.length){var s=new Date(i.substring(6,10),parseInt(i.substring(3,5))-1,i.substring(0,2));e("#MALCDateViewer").html(["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"][s.getDay()]+"<span class='month'>"+s.getDate()+" "+["JAN","FEV","MAR","AVR","MAI","JUIN","JUIL","AOU","SEP","OCT","NOV","DEC"][s.getMonth()]+"</span>")}else e("#MALCDateViewer").html("")}else e("#malctxtTitle").val(""),e("#MALCTitleViewer").html(""),e("#MALCTextViewer").html("<div style='text-align: center;'>Aucun message</div>"),e("#malcRTE").val(""),e("#malcIconSelected").add("#MALCIconViewer i").attr("class","fas fa-envelope"),e("#malctxtDate").val(""),e("#MALCDateViewer").html("");MEUpdateWidgetGrid()},a.malcOpenMessageInPopin=function(){var t=.8*e(window).width(),a=.8*e(window).height();t>800&&(t=800);var i=e("#MALCTextViewer iframe").clone();i.attr("style","width: 100%; height: 100%; background-color: #f9f9f9;"),e.fancybox({type:"html",closeBtn:!0,helpers:{overlay:{closeClick:!1,locked:!1}},width:t,height:a,transitionIn:"elastic",transitionOut:"elastic",titleShow:!1,autoSize:!1,content:i[0].outerHTML})},a.init=function(t){i=t,e(function(){i&&i.Message&&i.Message.length>0?(a.malcDisplayDatas(i),e(".malcEnsHeader .malcDelete").show()):a.malcDisplayDatas(null)})},a},meLib_WMessageALaClasse_Ens=function(e,t){var a={},i=null,n=null,s=!1,o="";return a.malcOpenEditor=function(){n=new nicEditor({iconsPath:o}).panelInstance("malcRTE"),MEC_Socle.PopinHelper.openGenericHtmlPopin(e("#malcTextEditorPopin"),!1,!1,null,!0),s||(s=!0,e.datetimepicker.setLocale("fr"),e("#malctxtDate").datetimepicker({format:"d/m/Y",todayButton:!0,timepicker:!1,minDate:"+1970/01/01",scrollInput:!1}))},a.malcCloseEditor=function(){if(!confirm("Attention, vos modifications ne seront pas sauvegardées. Continuer ?"))return!1;e.fancybox.close(),n.removeInstance("malcRTE")},a.malcValidMessage=function(t){MEC_Socle.PopinHelper.openLoaderPopin("Sauvegarde de votre message en cours..."),n.removeInstance("malcRTE"),t.disabled=!0;var a=e("#malcRTE").val();if(a){var s={Message:a.replace(/[\"”“]/g,"[DQUOT]").replace(/\’/g,"[SQUOT]"),Icon:e("#malcIconSelected").attr("class"),Date:e("#malctxtDate").val(),Titre:e("#malctxtTitle").val()};ajaxSaveWidgetOptions(i,s,function(){t.disabled=!1,MEC_Socle.PopinHelper.openResultPopin("Sauvegarde effectuée.","fa-check"),e(".malcEnsHeader .malcDelete").add(".MALCEnteteViewer").add("#MALCTitleViewer").add(".malcOpenMessage").show(),meWMALC.malcDisplayDatas(s)})}else alert("Veuillez saisir un message"),t.disabled=!1},a.malcRemove=function(t){t.disabled=!0,ajaxSaveWidgetOptions(i,null,function(){meWMALC.malcDisplayDatas(null),e(".malcEnsHeader .malcDelete").add(".MALCEnteteViewer").add("#MALCTitleViewer").add(".malcOpenMessage").hide(),t.disabled=!1})},a.init=function(t){i=t.wid,o=t.iconPathNiceEdit,e(function(){e("#templateIconSelector #iconSelector i").click(function(){e("#malcIconSelected").attr("class",e(this).attr("class")),e("#templateIconSelector").hide(),e("#malcRTEContainer").show()})})},a},meLib_WSuiviBlog=function(e,t){var a=null,i="",n="",s="",o=!1,l=null;function r(){e.post(MyAjaxVars.ajaxurl,{action:"meLoadWSBArticles",security:MyAjaxVars.postCommentNonce},function(e){e.success&&(a=e.articles,c(i))})}function c(t){e("#wsb_nav_"+t).addClass("wsbNavSelected").siblings().removeClass("wsbNavSelected"),e("#wsb_body").html("");var o=0;if(a&&a.length>0){for(var l=0;l<a.length;l++){if((c=a[l]).onglet==t){var r=e("#wsb_artTplt > .wsbArt").clone();r.attr("data-artindex",l).attr("data-artid",c.fluxid+";"+c.id).attr("data-fluxid",c.fluxid),e(".wsbArtTitle",r).attr("href",c.url).html(c.titre),e(".wsbArtDate",r).html(" le "+MEFormatDateForDisplay(c.date,!1)),e(".wsbArtSite",r).html(c.sitename),"1"==c.islike&&e(".wsbArtInfos .fa-heart",r).addClass("checked"),t!=i&&e(".wsbArtInfos .fa-eye-slash",r).remove(),t==s&&e(".wsbArtInfos .fa-heart",r).before("<span class='nbArtVotes'>"+c.nbvote+"</span>"),e("#wsb_body").append(r),o++}}for(l=0;l<a.length;l++){var c;(c=a[l]).onglet==n&&e(".wsbArt[data-artid='"+c.fluxid+";"+c.id+"'] .wsbArtInfos .fa-star").addClass("checked")}}0==o&&e("#wsb_body").html("Aucun article à afficher")}function d(){e.post(MyAjaxVars.ajaxurl,{action:"meLoadWSBOptions",security:MyAjaxVars.postCommentNonce},function(t){t.success&&(l=t.categList,function(){e("#wsbo_rssListItem").html("");for(var t=0;t<l.length;t++){var a=e("#wsbo_rssListItemTplt .categLine").clone();a.attr("data-categIndex",t),a.find(".colCheck input").prop("checked","1"==l[t].enabled),a.find(".colTitle").html(l[t].titre),e("#wsbo_rssListItem").append(a)}e("#wsbo_rssListItem .colCheck input").bootstrapToggle({on:"Suivi",off:"Non suivi",width:"100px"}),e("#wsboValidBtn").show(),parent.jQuery.fancybox.update()}())})}return{init:function(t,a,o){n=a,i=t,s=o,e(document).ready(function(){window.MEWAjaxQueue.push({function:"MELoadWSBArticlesFunc",params:{},callback:function(e){meWSuiviBlog.wsboArticlesLoaded(e.articles)}})})},initOption:function(){e(document).ready(function(){d()})},wsbLikeArt:function(t){var i=!!e(t).hasClass("checked"),n=e(t).parent(),s=n.html(),o=n.parents(".wsbArt").attr("data-artindex"),l=a[o].fluxid+";"+a[o].id;a[o].islike=i?"0":"1",n.html("<i class='fas fa-spinner fa-spin'></i>"),e.post(MyAjaxVars.ajaxurl,{action:"meWSBArticlesAddLike",security:MyAjaxVars.postCommentNonce,article:a[o]},function(t){if(n.html(s),t.success){e(".wsbArt[data-artid='"+l+"'] .fa-heart").toggleClass("checked");for(var i=0;i<a.length;i++)a[i].fluxid+";"+a[i].id==l&&(a[i].islike=a[o].islike)}})},wsbAddToFav:function(t){var i=e(t).hasClass("checked")?"1":"0",s=e(t).parent(),o=s.html(),l=s.parents(".wsbArt").attr("data-artindex"),r=a[l].fluxid+";"+a[l].id;s.html("<i class='fas fa-spinner fa-spin'></i>"),e.post(MyAjaxVars.ajaxurl,{action:"meWSBArticlesAddToFav",security:MyAjaxVars.postCommentNonce,article:a[l],toDelete:i},function(t){if(s.html(o),t.success)if(e(".wsbArt[data-artid='"+r+"'] .fa-star").toggleClass("checked"),"1"==i){for(var c=0;c<a.length;c++)if(a[c].fluxid+";"+a[c].id==r&&a[c].onglet==n){a.splice(c,1);break}e("#wsb_nav_Favoris").hasClass("wsbNavSelected")&&e(".wsbArt[data-artid='"+r+"']").remove()}else{var d=JSON.parse(JSON.stringify(a[l]));d.onglet=n,a.push(d)}})},wsbSelectTab:function(t){e(t).hasClass("wsbNavSelected")||("wsb_nav_Nouveauté"==t.id?c(i):"wsb_nav_Favoris"==t.id?c(n):"wsb_nav_Populaires"==t.id&&(o?c(s):(e("#wsb_widget #wsb_body").html("<i class='fas fa-spinner fa-spin'></i>"),e.post(MyAjaxVars.ajaxurl,{action:"meWSBArticlesGetPopulaires",security:MyAjaxVars.postCommentNonce},function(e){if(e.success){o=!0;for(var t=0;t<e.articles.length;t++)a.push(e.articles[t]);c(s)}}))),e(t).addClass("wsbNavSelected").siblings().removeClass("wsbNavSelected"))},wdbOpenOptions:function(){MEC_Socle.PopinHelper.openIframePopin("/widget-option/?class=MEWidgetSuiviBlog",!0,!0,function(){e("#wsb_body").html('<i class="fas fa-spinner fa-spin"></i>'),r()})},wsbBanFlux:function(t){var i=e(t).parents(".wsbArt").attr("data-artindex"),n=e(t).parents("#wsb_body"),s=n.html();confirm("Cette action aura pour effet de masquer tous les articles provenant de "+a[i].sitename+". Etes-vous sûr de vouloir continuer ?")&&(n.html("<i class='fas fa-spinner fa-spin'></i>"),e.post(MyAjaxVars.ajaxurl,{action:"meWSBBanFlux",security:MyAjaxVars.postCommentNonce,fluxid:a[i].fluxid},function(e){n.html(s),e.success&&setTimeout(r,500)}))},wsboUpdateEnabled:function(t){currentEditedIndex=e(t).parents(".categLine").attr("data-categIndex"),l[currentEditedIndex].enabled=e(t).is(":checked")?"1":"0"},wsboSaveData:function(t){t.disabled=!0,MEC_Socle.PopinHelper.openLoaderPopin("Sauvegarde en cours..."),e.post(MyAjaxVars.ajaxurl,{action:"meSaveWSBOptions",security:MyAjaxVars.postCommentNonce,categs:l},function(e){t.disabled=!1,e.success&&parent.jQuery.fancybox.close()})},wsboArticlesLoaded:function(e){a=e,c(i)}}},meLib_WTWT=function(e,t){var a={categList:null,textsList:null,statusList:null},i=null,n=null,s=null,o=null,l=!1,r=null,c=1,d=null;function u(){!function(){d=new Array;for(var e=0;e<a.textsList.length;e++){var t=a.textsList[e];d.hasOwnProperty(t.categID)||(d[t.categID]=new Array),d[t.categID].hasOwnProperty(t.status)?d[t.categID][t.status]++:d[t.categID][t.status]=1}}(),e(".tdtwCateg .notif").remove(),e(".tdtwCateg").each(function(){var t=e(this).attr("data-categid");d.hasOwnProperty(t)&&e(this).find("span").append(function(e){if(l&&e.hasOwnProperty(a.statusList.SENT))return"<span class='notif nb ens'>"+e[a.statusList.SENT]+"</span>";if(!l){if(e.hasOwnProperty(a.statusList.TO_CORRECT))return"<span class='notif nb correctneeded' title='Texte à corriger'><i class='fas fa-pen'></i></span>";if(e.hasOwnProperty(a.statusList.VALID))return"<span class='notif nb valid' title='Texte validé'><i class='fas fa-check'></i></span>";if(e.hasOwnProperty(a.statusList.SENT))return"<span class='notif nb waiting' title='Texte envoyé'><i class='fas fa-clock'></i></span>"}}(d[t]))})}return a.beforeCancel=function(){if(!confirm("Attention, vos modifications ne seront pas sauvegardées. Continuer ?"))return!1;e.fancybox.close(),i.removeInstance("tdtRTE")},a.saveText=function(t,s,o){MEC_Socle.PopinHelper.openLoaderPopin("Sauvegarde de votre texte en cours..."),i.removeInstance("tdtRTE"),t.disabled=!0;var r=-1,c=-1,d="";-1!=o&&(r=a.textsList[o].textID,l&&(c=a.textsList[o].eleID,d=a.textsList[o].eleveName)),e.post(MyAjaxVars.ajaxurl,{action:"meTDTSaveText",security:MyAjaxVars.postCommentNonce,text:e("#tdtRTE").val(),status:s,textID:r,categID:e("#tdtCboCateg").val(),categTitle:e("#tdtCboCateg option:selected").html(),elevID:c,eleveName:d},function(i){t.disabled=!1,i.success?(MEC_Socle.PopinHelper.openResultPopin("Sauvegarde effectuée.","fa-check"),-1==r?(n=a.textsList.push(i.text)-1,a.updateHTMLLine(n)):null!==n&&(i.text.status==a.statusList.DELETED?(a.textsList.splice(n,1),e(".tdtTextLine[data-tindex='"+n+"']").remove()):(a.textsList[n]=i.text,a.updateHTMLLine(n))),u(),setTimeout(function(){e.fancybox.close()},500)):MEC_Socle.PopinHelper.openResultPopin(i.data,"fa-exclamation-circle")})},a.updateHTMLLine=function(t){var i=a.textsList[t],n=s;l&&(n=o);var r='<div class="tdtTextLine '+i.status+' meWidgetLine" data-tindex="'+t+'" onclick="meWTWT.editText(this)">                            <span class="categTitle"><i class=\'fas fa-file-alt\'></i>'+(l?i.eleveName:"mon texte "+(c>1?c:""))+'</span>                            <span class="status">'+n[i.status]+"</span>";c++,i.status==a.statusList.SENT||i.status==a.statusList.VALID?r+="<div class='actionIcons'><i class='fas fa-eye'></i></div>":r+="<div class='actionIcons'><i class='fas fa-pen'></i></div>",r+="</div>",0==e(".tdtTextLine[data-tindex='"+t+"']").length?e("#tdtwTextPanel").prepend(r):(e(".tdtTextLine[data-tindex='"+t+"']").after(r),e(".tdtTextLine[data-tindex='"+t+"']").first().remove()),MEUpdateWidgetGrid()},a.editText=function(t){var s=e(t).attr("data-tindex");n=s;var o=!1;if(l?o=!0:a.textsList[s].status!=a.statusList.SENT&&a.textsList[s].status!=a.statusList.VALID&&(o=!0),o){e("#tdtCategArea").empty().append("<label for='tdtCboCateg'>Sélectionnez une tâche : </label><select id='tdtCboCateg'><option value='-1'></option></select>");for(var c=0;c<a.categList.length;c++)e("#tdtCboCateg").append("<option value='"+MEC_Socle.CommonFunctions.encodeHtmlTags(a.categList[c].id)+"'"+(a.textsList[s].categID==a.categList[c].id?" selected":"")+">"+MEC_Socle.CommonFunctions.encodeHtmlTags(a.categList[c].libelle)+"</option>");l?e("#tdtActionArea").empty().append("                    <input type=button value='Annuler' onclick='meWTWT.beforeCancel();' />                     <input type=button value='Supprimer' onclick='meWTWT.saveText(this, \""+a.statusList.DELETED+'", '+s.toString()+");' />                     <input type=button value='A corriger' onclick='meWTWT.saveText(this, \""+a.statusList.TO_CORRECT+'", '+s.toString()+");' />                     <input type=button value='Valider' onclick='meWTWT.saveText(this, \""+a.statusList.VALID+'", '+s.toString()+");' /> "):(e("#tdtCategArea").hide(),e("#tdtActionArea").empty().append("                    <input type=button value='Annuler' onclick='meWTWT.beforeCancel();' />                     <input type=button value='Supprimer' onclick='meWTWT.saveText(this, \""+a.statusList.DELETED+'", '+s.toString()+");' />                     <input type=button value='Enregistrer' onclick='meWTWT.saveText(this, \""+a.statusList.DRAFT+'", '+s.toString()+");' />                     <input type=button value='Envoyer' onclick='meWTWT.saveText(this, \""+a.statusList.SENT+'", '+s.toString()+");' />")),e("#tdtRTE").show().val(a.textsList[s].texte),e("#tdtRTEDisplay").hide(),i=new nicEditor({iconsPath:r+"/js/nicEditWithColor/nicEditorIcons.gif"}).panelInstance("tdtRTE"),MEC_Socle.PopinHelper.openGenericHtmlPopin(e("#tdtTextEditorPopinContainer"),!1,!1,null,!0)}else e("#tdtCategArea").empty().append("Tâche : "+MEC_Socle.CommonFunctions.encodeHtmlTags(a.textsList[s].categTitle)),e("#tdtRTE").hide(),a.AddSecureTextInRTEDisplay(a.textsList[s].texte),e("#tdtActionArea").empty().append("<input type=button value='Fermer' onclick='jQuery.fancybox.close();' />"),MEC_Socle.PopinHelper.openGenericHtmlPopin(e("#tdtTextEditorPopinContainer"),!0,!1,null,!0)},a.AddSecureTextInRTEDisplay=function(t){var a=document.createElement("iframe");a.sandbox="allow-popups",a.srcdoc='<html><head><base target="_blank"/></head><body>'+t+"</body></html>",e(a).attr("style","width: 700px;height: 300px;"),e("#tdtRTEDisplay").empty().append(a).show()},a.createText=function(t){e("#tdtCategArea").empty().append("<label for='tdtCboCateg'>Sélectionnez une tâche : </label><select id='tdtCboCateg'><option value='-1'></option></select>");for(var n=0;n<a.categList.length;n++)e("#tdtCboCateg").append("<option value='"+MEC_Socle.CommonFunctions.encodeHtmlTags(a.categList[n].id)+"' "+(t==a.categList[n].id?"selected":"")+">"+MEC_Socle.CommonFunctions.encodeHtmlTags(a.categList[n].libelle)+"</option>");l||e("#tdtCategArea").hide(),e("#tdtActionArea").empty().append("            <input type=button value='Annuler' onclick='meWTWT.beforeCancel();' />             <input type=button value='Enregistrer' onclick='meWTWT.saveText(this, \""+meWTWT.statusList.DRAFT+"\", -1);' />             <input type=button value='Envoyer' onclick='meWTWT.saveText(this, \""+meWTWT.statusList.SENT+"\", -1);' />"),e("#tdtRTE").show().val(""),e("#tdtRTEDisplay").hide(),i=new nicEditor({iconsPath:r+"/js/nicEditWithColor/nicEditorIcons.gif"}).panelInstance("tdtRTE"),MEC_Socle.PopinHelper.openGenericHtmlPopin(e("#tdtTextEditorPopinContainer"),!1,!1)},a.insertCategHeader=function(t,i){var n="<div class='tdtwPrev actionIcons'><i class='fas fa-arrow-left' onclick='meWTWT.prevClick(this)'></i></div>";n+="-1"==t?"<div class='categTitle meWidgetSubHeaderTitle eleveSize'>Texte libre</div></div>":"<div class='categTitle meWidgetSubHeaderTitle eleveSize'>"+MEC_Socle.CommonFunctions.encodeHtmlTags(meWTWT.categList[i].libelle)+"</div></div>",e("#tdtwCategHeader").html(n),c=1;for(var s=0;s<meWTWT.textsList.length;s++)meWTWT.textsList[s].categID!=t||l&&meWTWT.textsList[s].status==meWTWT.statusList.DRAFT||a.updateHTMLLine(s);e("#tdtwTextPanel").append('            <div class="tdtTextLine tdtNewTextLine meWidgetLine meWidgetCreateLine" onclick="meWTWT.createText('+t+')">                <div class="actionIcons"><i class="fas fa-plus"></i></div><span>Nouveau texte</span>            </div>')},a.openCategDetails=function(t){var i=e(t).attr("data-categid"),n=e(t).attr("data-categindex");e("#tdtwTextPanel").add("#tdtwCategHeader").empty(),e("#tdtwCategHeader").attr("data-categid",i).attr("data-categindex",n),l?meWTWT.enseignant.insertCategHeader(i,n):a.insertCategHeader(i,n),0==e(".tdtTextLine").length&&(e("#tdtwTextPanel").append("Aucun texte"),MEUpdateWidgetGrid()),e("#tdtwCategsPanel").hide(),e("#tdtwCategDetailsPanel").show()},a.prevClick=function(){e("#tdtwCategsPanel").show(),e("#tdtwCategDetailsPanel").hide(),MEUpdateWidgetGrid()},a.init=function(t){a.categList=t.categs,a.textsList=t.texts,a.statusList=t.statusList,s=t.statusLibellesListEleve,o=t.statusLibellesListEns,l=t.isEns,r=t.stylesheeturl,e(function(){u()})},a},meLib_WTWT_Ens=function(e,t){var a={},i=null;return a.tdtwCreateCateg=function(t){e(t).hide().next(".tdtwInputCateg").show().children("input").focus()},a.tdtwValidCateg=function(n,s){var o=e(n).parent(".tdtwInputCateg"),l=o.children("input");if(l.val()){if(s===t)return void MEGroupSelectorPopin.open("Afficher au(x) groupe(s)",new Array,!0,function(t){a.tdtwValidCateg(e(".tdtwInputCateg i")[0],t)},!0);o.children("i").attr("class","fa fa-spinner fa-spin").removeAttr("onclick"),e.post(MyAjaxVars.ajaxurl,{action:"meCreateCateg",security:MyAjaxVars.postCommentNonce,categTitle:l.val(),groupsExcludes:s},function(e){if(o.children("i").attr("class","fas fa-check").attr("onclick","meWTWT.enseignant.tdtwValidCateg(this);"),e.success){var t=i;t.id=e.ID,t.libelle=l.val(),t.groupeExcluded=s;var a=meWTWT.categList.push(t)-1;o.hide().prev(".tdtwCreateCateg").show(),o.prev(".tdtwCreateCateg").before('                            <div class="tdtwCateg meWidgetLine" data-categid="'+e.ID+'" data-categindex="'+a+'" onclick=\'meWTWT.openCategDetails(this)\'>                                <div class="iconDebut actionIcons">                                    <i class="fas fa-archive"></i>                                </div>                                <span>'+l.val()+"</span>                            </div>"),l.val(""),MEUpdateWidgetGrid()}})}},a.editGroupOnCateg=function(t){var a=e("#tdtwCategHeader").attr("data-categid"),i=e("#tdtwCategHeader").attr("data-categindex");MEGroupSelectorPopin.open("Afficher au(x) groupe(s)",meWTWT.categList[i].groupeExcluded,!0,function(t){meWTWT.categList[i].groupeExcluded=t,setTimeout(function(){MEC_Socle.PopinHelper.openLoaderPopin("Enregistrement en cours"),MEC_Socle.AjaxHelper.GenAjaxCaller("meTdtUpdateCategGroups",{categId:a,groupsExcludes:t},function(){MEGroupSelectorPopin.updateIconAndTitle(e("#tdtwCategHeader .actionIcons .fa-users"),!0,t),jQuery.fancybox.close()})},50)},!1)},a.tdtwEditCategTitle=function(t){e(t).hide();var a=e(t).parents("#tdtwCategHeader").find(".categTitle"),i=a.text();a.html("<input type='text' value='' onkeypress=\"(event.keyCode == 13) ? meWTWT.enseignant.tdtwUpdateCategTitle(this) : '';\" /><i class='fas fa-check' onclick='meWTWT.enseignant.tdtwUpdateCategTitle(this)'></i>"),a.find("input").val(i).focus()},a.tdtwUpdateCategTitle=function(t){var a=e(t).parent(),i=a.find("input").val(),n=e("#tdtwCategHeader").attr("data-categid");t.disabled=!0,i&&(a.children("i").attr("class","fa fa-spinner fa-spin").removeAttr("onclick"),e.post(MyAjaxVars.ajaxurl,{action:"meTdtUpdateCateg",security:MyAjaxVars.postCommentNonce,categTitle:i,categId:n},function(s){if(t.disabled=!1,a.children("i").attr("class","fas fa-check").attr("onclick","meWTWT.enseignant.tdtwUpdateCategTitle(this);"),s.success){a.html(MEC_Socle.CommonFunctions.encodeHtmlTags(i)),a.parent().find(".fa-pen").show();var o=e("#tdtwCategsPanel .tdtwCateg[data-categid='"+n+"']");e("span",o).html(MEC_Socle.CommonFunctions.encodeHtmlTags(i)),meWTWT.categList[o.attr("data-categindex")].libelle=i}}))},a.tdtwOpenAllCategText=function(t){var a="";e("#tdtwTextPanel .tdtTextLine").each(function(){var t=e(this).attr("data-tindex");a+="<p><b>Texte de "+meWTWT.textsList[t].eleveName+" : </b></p>",a+=meWTWT.textsList[t].texte+"<p></p>"}),e("#tdtCategArea").empty().append("Tâche : "+e(t).parents("#tdtwCategHeader").find(".categTitle").html()),e("#tdtRTE").hide(),meWTWT.AddSecureTextInRTEDisplay(a),e("#tdtActionArea").empty().append("<input type=button value='Fermer' onclick='jQuery.fancybox.close();' />"),MEC_Socle.PopinHelper.openGenericHtmlPopin(e("#tdtTextEditorPopinContainer"),!0,!1)},a.tdtwDeleteCateg=function(t){if(confirm("Etes-vous sûr de vouloir supprimer cette tâche et tous ses textes ?")){var a=e("#tdtwCategHeader").attr("data-categid");MEC_Socle.PopinHelper.openLoaderPopin("Suppression en cours..."),e.post(MyAjaxVars.ajaxurl,{action:"meTdtDeleteCategAndTexts",security:MyAjaxVars.postCommentNonce,categId:a},function(t){t.success&&(e.fancybox.close(),e("#tdtwCategHeader").attr("data-categid","").empty(),e("#tdtwTextPanel").empty(),e("#tdtwCategsPanel .tdtwCateg[data-categid='"+a+"']").remove(),meWTWT.prevClick())})}},a.insertCategHeader=function(t,a){var i="<div class='tdtwPrev actionIcons'><i class='fas fa-arrow-left' onclick='meWTWT.prevClick(this)'></i></div>";i+="-1"==t?"<div class='categTitle meWidgetSubHeaderTitle'>Texte libre</div>                                <div class='actionIcons'>":"<div class='categTitle meWidgetSubHeaderTitle'>"+MEC_Socle.CommonFunctions.encodeHtmlTags(meWTWT.categList[a].libelle)+"</div>                                <div class='actionIcons rightIcons'>                                    <i class='fas fa-pen' onclick='meWTWT.enseignant.tdtwEditCategTitle(this)'></i>                                    <i class='fas fa-users' onclick='meWTWT.enseignant.editGroupOnCateg(this)'></i>",i+="<i class='fas fa-download' onclick='meWTWT.enseignant.tdtwOpenAllCategText(this)'></i>                            <i class='fas fa-trash' onclick='meWTWT.enseignant.tdtwDeleteCateg(this)'></i>                            </div>",e("#tdtwCategHeader").html(i),-1!=t&&MEGroupSelectorPopin.updateIconAndTitle(e("#tdtwCategHeader .actionIcons .fa-users"),!0,meWTWT.categList[a].groupeExcluded);for(var n=0;n<meWTWT.textsList.length;n++)meWTWT.textsList[n].categID==t&&meWTWT.textsList[n].status!=meWTWT.statusList.DRAFT&&meWTWT.updateHTMLLine(n)},a.init=function(e){i=e.newAssociationObj},a},meLib_WOFPubWidget=function(e,t,a){var i={},n=null,s=null,o=null,l=null,r=null,c=null,d=null;return i.publiTypeChange=function(){if(o.is(":checked"))l.hide(),parent.jQuery.fancybox.update();else if(null==n)MEC_Socle.AjaxHelper.GenAjaxCaller("meLoadWidgetPublicationList",{widgetID:e},function(e){null!=e.publiList&&e.publiList.length>0&&(n=e.publiList,i.publiTypeChange())});else{var a=r.find("ul.inner").empty(),c=null;n.forEach(function(e){a.append(t("<li>",{"data-value":e.id,"data-level":"1",html:'<a href="#">'+MEC_Socle.CommonFunctions.htmlEncode(e.title)+"</a>"})),e.autoDisplayed&&(c=e.id)}),null!=s&&a.find("li[data-value='"+s+"'] a").trigger("click"),null!=c&&(a.find("li[data-value='"+c+"']").attr("data-autoselect","1"),null==s&&a.find("li[data-value='"+c+"'] a").trigger("click")),l.show()}},i.publiListChange=function(){d.empty(),s=c.val(),!o.is(":checked")&&s&&MEC_Socle.AjaxHelper.GenAjaxCaller("meLoadWidgetPublicationPrevisu",{widgetID:e,elemID:s},function(e){null!=e.publiImage&&(d.append(t("<img>",{src:e.publiImage,onload:"parent.jQuery.fancybox.update();"})),d.append(t("<div>",{class:"publiMetas",html:"<ul><li>"+e.publiMeta.join("</li><li>")+"</li></ul>"})))})},i.showPrevPubli=function(){var e=r.find("li[data-value='"+c.val()+"']");e.prev("li").length>0?e.prev("li").find("a").trigger("click"):r.find("ul.inner").children("li").last().find("a").trigger("click")},i.showNextPubli=function(){var e=r.find("li[data-value='"+c.val()+"']");e.next("li").length>0?e.next("li").find("a").trigger("click"):r.find("ul.inner").children("li").first().find("a").trigger("click")},i.savePublication=function(t){t.disabled=!0;var a=null;a=!o.is(":checked")&&s?{pubtype:"manu",pubid:s}:{pubtype:"auto"},parent&&parent.ME_PageManageWidget&&parent.ME_PageManageWidget.widgetsList?(parent.ME_PageManageWidget.widgetsList.forEach(function(t){t.id==e&&(t.options=JSON.stringify(a),parent.ME_PageManageWidget.preventQuitPage(!0))}),parent.jQuery.fancybox.close()):(MEC_Socle.PopinHelper.openLoaderPopin("Sauvegarde en cours..."),MEC_Socle.AjaxHelper.GenAjaxCaller("meSaveWidgetPublicationSettings",{widgetID:e,options:a},function(){parent.location.reload()},t))},t(function(){var a;o=t("#chkPubliAuto"),l=t("#widgetOptionPubliManuOptions"),d=t("#publiPrevisuZone"),r=t("#cboPublicationsList").hierarchySelect(),(c=t("input[name='txtForPublicationFilter']")).change(i.publiListChange),o.change(i.publiTypeChange).bootstrapToggle({off:"manuelle",on:"automatique",width:"140px"}),a=null,parent&&parent.ME_PageManageWidget&&parent.ME_PageManageWidget.widgetsList?parent.ME_PageManageWidget.widgetsList.forEach(function(t){t.id==e&&(a=JSON.parse(t.options))}):parent.window.hasOwnProperty("PubliOption"+e)&&(a=parent.window["PubliOption"+e]),a&&("manu"==a.pubtype&&(s=a.pubid),o.bootstrapToggle("auto"==a.pubtype?"on":"off"))}),i},meLib_WWOTD=function(e,t){var a=null;return e(function(){e("#WordOfTheDayWidget .wotdSound").click(function(){var t=e(this).attr("data-sound");null==a&&(a=e("<audio>",{autoplay:!1,src:t,style:"display:none;"}).appendTo(e("#WordOfTheDayWidget"))),a[0].play()}),e("#WordOfTheDayWidget .firstPanel .wotdButtonBottomZone a").click(function(){e("#WordOfTheDayWidget .firstPanel").hide(),e("#WordOfTheDayWidget .secondPanel").show()}),e("#WordOfTheDayWidget .secondPanel .questionBonusButton a").click(function(){e("#WordOfTheDayWidget .secondPanel .questionBonusButton").hide(),e("#WordOfTheDayWidget .secondPanel .wotdReponseBonus").show()});var t=0;e("#WordOfTheDayWidget .wotdCasesCont .wotdCase").each(function(){e(this).css("left",t%3*100),e(this).css("top",100*Math.floor(t/3)),e(this).click(function(){e(this).addClass("Clicked")}),t++})}),{}};