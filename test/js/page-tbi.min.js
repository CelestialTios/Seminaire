jQuery(function(){if(jQuery("#home #site-navigation").add("#rlConnectionWidget").remove(),jQuery("#home #main-nav").append(jQuery(".backgroundSelector").clone()),resizeIframe(),/iPhone|iPod|iPad|Mac OS/.test(navigator.userAgent)&&jQuery("iframe").wrap(function(){var e=jQuery(this);return jQuery('<div id="browserIFrameScroller" class="browserIFrame" />').css({width:e.attr("width"),height:e.attr("height"),overflow:"auto","-webkit-overflow-scrolling":"touch"})}),jQuery(".drawModeSwitcher a").add(".peCont").add(".painterReseter").add(".texterSettings > div").tooltipster({animation:"grow",theme:"tooltipster-light",delay:50,side:["right","bottom","top","left"]}),jQuery(".tbiActivitySelector").tooltipster({animation:"grow",theme:"tooltipster-light",delay:50,side:["bottom","top","left","right"]}),QueryString.activity?(document.getElementById("browserIFrame").src=decodeURIComponent(QueryString.activity),modeIframe=!0):QueryString.widget?(jQuery("#browserIFrame").add("#browserIFrameScroller").add(".textDisplContainer").hide(),jQuery("#meObjectContainer").show(),setTimeout(CallAjaxForWidgets,10)):1==QueryString.actinteractopen?setTimeout(function(){displayActivityInteractivPanel(!0)},500):1==QueryString.supporttravailopen?setTimeout(displaySupportTravail,500):1==QueryString.widgetopen&&setTimeout(displayWidgetSelector,500),QueryString.addtofav){displayActivityInteractivPanel();var e=jQuery(".taFav[data-actid='"+QueryString.addtofav+"']").first();toggleActivities("subdomaine",e.parent(".taRow").prevAll(".subdomaine").first()[0],!0),addActivityToFav(e.find("i")[0],QueryString.activate)}document.getElementById("inputPictUserUploader").onchange=userImageUploaded});var eventMethod=window.addEventListener?"addEventListener":"attachEvent",eventer=window[eventMethod],messageEvent="attachEvent"==eventMethod?"onmessage":"message",keyDownEvent="attachEvent"==eventMethod?"onkeydown":"keydown";function resizeIframe(){var e=document.getElementById("browserIFrame");null!=e&&(e.height=window.innerHeight-document.getElementById("home").clientHeight)}eventer(messageEvent,function(e){"ScrollTopPlease"==e.data&&jQuery("#browserIFrame").parent("div").scrollTop(0)},!1),eventer(keyDownEvent,CheckCtrlZEvent,!1),window.onresize=resizeIframe;var canvas,canvasMarker,ctx,deltaY=0,deltaX=0,painterColor="#353535",painterWidth=10,eraser=!1,dragging=!1,canvasHistory=new Array,curHistoryIndex=0;function initCanvas(e,t){e.width=window.innerWidth-60,e.height=window.innerHeight-document.getElementById("home").clientHeight,(ctx=e.getContext("2d")).lineWidth=2*painterWidth,ctx.fillStyle=painterColor,ctx.strokeStyle=painterColor,deltaY=document.getElementById("content").offsetTop,deltaX=document.getElementById("contentPanel").offsetLeft,dragging=!1,e.addEventListener("mousedown",engage,!1),e.addEventListener("mousemove",putPoint,!1),t?e.addEventListener("mouseup",disengageFromMarkerCanvas,!1):(e.addEventListener("mouseup",disengage,!1),addStepToCanvasHistory(e)),e.addEventListener("touchstart",touchStartEvent,!1),e.addEventListener("touchend",touchEndEvent,!1),e.addEventListener("touchmove",touchMoveEvent,!1),document.body.addEventListener("touchstart",function(e){e.target!=canvas&&e.target!=canvasMarker||e.preventDefault()},!1),document.body.addEventListener("touchend",function(e){e.target!=canvas&&e.target!=canvasMarker||e.preventDefault()},!1),document.body.addEventListener("touchmove",function(e){e.target!=canvas&&e.target!=canvasMarker||e.preventDefault()},!1)}function updateCanvasContext(){ctx.lineWidth=2*painterWidth,ctx.fillStyle=painterColor,ctx.strokeStyle=painterColor}var engage=function(e){dragging=!0,putPoint(e)},disengage=function(){dragging=!1,addStepToCanvasHistory(canvas),ctx.beginPath()},disengageFromMarkerCanvas=function(){dragging=!1,ctx.beginPath();var e=canvas.getContext("2d");e.globalAlpha=.4,e.drawImage(canvasMarker,0,0),e.globalAlpha=1,ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height),addStepToCanvasHistory(canvas)},putPoint=function(e){dragging&&(ctx.lineTo(e.clientX-deltaX,e.clientY-deltaY),ctx.stroke(),ctx.beginPath(),ctx.arc(e.clientX-deltaX,e.clientY-deltaY,painterWidth,0,2*Math.PI),ctx.fill(),ctx.beginPath(),ctx.moveTo(e.clientX-deltaX,e.clientY-deltaY))},touchStartEvent=function(e){var t=e.touches[0],i=new MouseEvent("mousedown",{clientX:t.clientX,clientY:t.clientY});ctx.canvas.dispatchEvent(i)},touchEndEvent=function(e){var t=new MouseEvent("mouseup",{});ctx.canvas.dispatchEvent(t)},touchMoveEvent=function(e){var t=e.touches[0],i=new MouseEvent("mousemove",{clientX:t.clientX,clientY:t.clientY});ctx.canvas.dispatchEvent(i)};function eraseAll(){canvas.getContext("2d").clearRect(0,0,canvas.width,canvas.height),addStepToCanvasHistory(canvas)}function enableEraser(e){jQuery(e).addClass("selected").siblings().removeClass("selected"),switchToPaintMode(jQuery(".tbiModeSwitcher .fa-pen-alt").parent()[0]),ctx.globalCompositeOperation="destination-out"}function drawColor(e){jQuery(e).addClass("selected").siblings().removeClass("selected"),painterColor=jQuery(e).attr("data-colorcode"),ctx.fillStyle=painterColor,ctx.strokeStyle=painterColor,ctx.globalCompositeOperation="source-over"}function drawWidth(e){jQuery(e).addClass("selected").siblings().removeClass("selected"),painterWidth=jQuery(e).attr("data-width"),ctx.lineWidth=2*painterWidth}var addStepToCanvasHistory=function(e){canvasHistory.splice(curHistoryIndex+1,canvasHistory.length-(curHistoryIndex+1)),canvasHistory.push(e.toDataURL()),curHistoryIndex=canvasHistory.length-1,canvasHistory.length>30&&canvasHistory.splice(0,canvasHistory.length-30)};function undoCanvasDraft(){var e=canvas.getContext("2d");if(curHistoryIndex--,canvasHistory.length>curHistoryIndex&&curHistoryIndex>=0){var t=e.globalCompositeOperation;e.globalCompositeOperation="source-over";var i=new Image;i.src=canvasHistory[curHistoryIndex],i.onload=function(){e.clearRect(0,0,canvas.width,canvas.height),e.drawImage(i,0,0),e.globalCompositeOperation=t}}else curHistoryIndex<0&&(curHistoryIndex=0)}function redoCanvasDraft(){var e=canvas.getContext("2d");if(curHistoryIndex++,canvasHistory.length>curHistoryIndex&&curHistoryIndex>=0){var t=e.globalCompositeOperation;e.globalCompositeOperation="source-over";var i=new Image;i.src=canvasHistory[curHistoryIndex],i.onload=function(){e.clearRect(0,0,canvas.width,canvas.height),e.drawImage(i,0,0),e.globalCompositeOperation=t}}else curHistoryIndex=canvasHistory.length-1}function CheckCtrlZEvent(e){var t=window.event?event:e;90==t.keyCode&&t.ctrlKey&&null!=canvas&&undoCanvasDraft(),89==t.keyCode&&t.ctrlKey&&null!=canvas&&redoCanvasDraft()}var modeIframe=!1;function switchToNavMode(e){jQuery(e).addClass("enabled").siblings().removeClass("enabled"),jQuery(".painterSettings").add(".texterSettings").hide(),jQuery(".textDisplContainer").hide(),modeIframe?null!=canvas?(jQuery("#markerCanvas").hide(),toggleCanvasVisibility(!1,".browserIFrame")):jQuery("#browserIFrame").add("#browserIFrameScroller").show():null!=canvas?(jQuery("#markerCanvas").hide(),toggleCanvasVisibility(!1,"#meObjectContainer")):jQuery("#meObjectContainer").show()}function switchToPaintMode(e){jQuery(e).addClass("enabled").siblings().removeClass("enabled"),jQuery(".painterSettings").css("display","inline-block"),jQuery(".texterSettings").add(".fastPictAdder").hide(),jQuery("#markerCanvas").hide(),null==canvas?initCanvas(canvas=document.getElementById("drawingCanvas"),!1):(ctx=canvas.getContext("2d"),updateCanvasContext(),toggleCanvasVisibility(!0))}function switchToMarkerMode(e){jQuery(e).addClass("enabled").siblings().removeClass("enabled"),jQuery(".painterSettings").css("display","inline-block"),jQuery(".texterSettings").add(".fastPictAdder").hide(),jQuery("#markerCanvas").show(),toggleCanvasVisibility(!0),jQuery(".painterEraser").hasClass("selected")&&drawColor(jQuery(".pcCont").first()[0]),null==canvasMarker?(null==canvas?initCanvas(canvas=document.getElementById("drawingCanvas"),!1):toggleCanvasVisibility(!0),ctx.globalCompositeOperation="source-over",initCanvas(canvasMarker=document.getElementById("markerCanvas"),!0)):(ctx=canvasMarker.getContext("2d"),updateCanvasContext())}function switchToTextMode(e){jQuery(e).addClass("enabled").siblings().removeClass("enabled"),jQuery(".painterSettings").add(".fastPictAdder").hide(),jQuery("#browserIFrame").add("#browserIFrameScroller").hide(),jQuery("#meObjectContainer").hide(),jQuery("#markerCanvas").hide(),toggleCanvasVisibility(!1,".textDisplContainer"),jQuery(".texterSettings").css("display","inline-block"),""==jQuery("#textDisplayer").html()&&tbiOpenEditor()}function toggleCanvasVisibility(e,t){e&&!jQuery("#drawingCanvas").is(":visible")?(jQuery("#drawingCanvas").show(),jQuery("#drawingCanvas").animate({opacity:1,left:0},500,null)):!e&&jQuery("#drawingCanvas").is(":visible")?jQuery("#drawingCanvas").animate({opacity:0,left:"-"+jQuery("#drawingCanvas").width()},500,function(){null!=t&&jQuery(t).show(),jQuery("#drawingCanvas").hide()}):null!=t&&jQuery(t).show()}var tbiFontSize=1,tbiLineHeight=1.4,textBiggerEventID=null,textLowerEventID=null,intervalBiggerEventID=null,intervalLowerEventID=null;function tbiOpenEditor(){MEC_Socle.PopinHelper.openGenericHtmlPopin(jQuery("#tbiTextEditorPopin"),!1,!1),setTimeout(function(){jQuery("#tbiRTE").focus()},200)}function tbiCloseEditor(){jQuery.fancybox.close()}function tbiValidText(){jQuery("#textDisplayer").html(MEC_Socle.CommonFunctions.encodeHtmlTags(jQuery("#tbiRTE").val()).replace(/(?:\r\n|\r|\n)/g,"<br/>")),jQuery.fancybox.close()}function tbiTextBigger(){tbiFontSize+=.1,tbiLineHeight+=.1,jQuery("#textDisplayer").css("font-size",tbiFontSize+"em").css("line-height",tbiLineHeight+"em")}function tbiTextLower(){tbiFontSize-=.1,tbiLineHeight-=.1,jQuery("#textDisplayer").css("font-size",tbiFontSize+"em").css("line-height",tbiLineHeight+"em")}function tbiIntervalBigger(){tbiLineHeight+=.1,jQuery("#textDisplayer").css("line-height",tbiLineHeight+"em")}function tbiIntervalLower(){tbiLineHeight-=.1,jQuery("#textDisplayer").css("line-height",tbiLineHeight+"em")}function tbiEraseAll(){jQuery("#textDisplayer").add("#tbiRTE").empty()}function gotoFullScreen(e){var t=document.documentElement;jQuery(e).hasClass("selected")?(jQuery(e).removeClass("selected"),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()):(jQuery(e).addClass("selected"),t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen())}function displayActivityInteractivPanel(e){MEC_Socle.PopinHelper.openGenericHtmlPopin(jQuery("#InterActSelectContainer"),!0,!1),1==e&&toggleActivities("favoris",null,!0)}function toggleActivities(e,t,i){var a=jQuery(t).find("i"),n=jQuery(t).find(".libelle").html(),r=!a.hasClass("fa-minus-hexagon");if(i&&(r=!0),jQuery(".listOfActivities .domaine").find("i").removeClass("fa-minus-hexagon").addClass("fa-plus-hexagon"),jQuery(".listOfActivities .subdomaine").hide().find("i").removeClass("fa-minus-hexagon").addClass("fa-plus-hexagon"),jQuery(".listOfActivities .taRow").hide(),1==r){if("domaine"==e&&(jQuery(t).siblings(".subdomaine[data-domaine='"+n+"']").show(),a.addClass("fa-minus-hexagon").removeClass("fa-plus-hexagon")),"subdomaine"==e){var o=jQuery(t).attr("data-domaine");jQuery(t).prev(".domaine").first().find("i").addClass("fa-minus-hexagon").removeClass("fa-plus-hexagon"),jQuery(".listOfActivities .subdomaine[data-domaine='"+o+"']").show(),jQuery(t).siblings(".taRow[data-domaine='"+o+"'][data-subdom='"+n+"']").show(),a.addClass("fa-minus-hexagon").removeClass("fa-plus-hexagon")}"favoris"==e&&jQuery(".listOfActivities .subdomaine[data-domaine='Favoris']").length>0&&(jQuery(".listOfActivities .domaine").first().show().find("i").addClass("fa-minus-hexagon").removeClass("fa-plus-hexagon"),jQuery(".listOfActivities .subdomaine[data-domaine='Favoris']").show(),jQuery(".listOfActivities .taRow[data-domaine='Favoris']").show())}return jQuery.fancybox.update(),!1}function launchInteractivActivity(e){return document.location.href="/tbi-integration/?activity="+encodeURIComponent(e),!1}function addActivityToFav(e,t){var i=jQuery(e).parent(),a=i.attr("data-actid"),n=!i.hasClass("alreadyFav");if("true"==t&&(n=!0),i.html("<i class='fas fa-spinner fa-spin'></i>"),"http:"==document.location.protocol){var r="?addtofav="+a+"&activate="+n;document.location.href="https://"+document.location.host+"/"+document.location.pathname+r}else jQuery.post(MyAjaxVars.ajaxurl,{action:"meTBIAddActivityToFav",security:MyAjaxVars.postCommentNonce,actid:a,activate:n},function(e){e.success&&(n?jQuery(".taFav[data-actid='"+a+"']").addClass("alreadyFav").html("<i class='fas fa-star' onclick='addActivityToFav(this)'></i>"):jQuery(".taFav[data-actid='"+a+"']").removeClass("alreadyFav").html("<i class='fas fa-star' onclick='addActivityToFav(this)'></i>"))})}jQuery(function(){jQuery("#tbiBigger").on("click touch",tbiTextBigger).on("mousedown touchstart",function(e){clearInterval(textLowerEventID),textBiggerEventID=setInterval(tbiTextBigger,200)}).bind("mouseup mouseleave touchend",function(){clearInterval(textBiggerEventID)}),jQuery("#tbiLower").on("click touch",tbiTextLower).on("mousedown touchstart",function(e){clearInterval(textBiggerEventID),textLowerEventID=setInterval(tbiTextLower,200)}).bind("mouseup mouseleave touchend",function(){clearInterval(textLowerEventID)}),jQuery("#tbiInterlignePlus").on("click touch",tbiIntervalBigger).on("mousedown touchstart",function(e){clearInterval(intervalLowerEventID),intervalBiggerEventID=setInterval(tbiIntervalBigger,200)}).bind("mouseup mouseleave touchend",function(){clearInterval(intervalBiggerEventID)}),jQuery("#tbiInterligneMoins").on("click touch",tbiIntervalLower).on("mousedown touchstart",function(e){clearInterval(intervalBiggerEventID),intervalLowerEventID=setInterval(tbiIntervalLower,200)}).bind("mouseup mouseleave touchend",function(){clearInterval(intervalLowerEventID)})});var tbiSupportCurSize=1,tbiCurSupport=null,tbiCurSupportKey=null;function displaySupportTravail(){MEC_Socle.PopinHelper.openGenericHtmlPopin(jQuery("#SupportSelectContainer"),!0,!1)}function SelectSupport(e,t){jQuery("#browserIFrame").add("#browserIFrameScroller").hide(),jQuery("#meWidgetDisplayer").remove(),modeIframe=!1,jQuery(t).parent().addClass("selected").siblings().removeClass("selected"),tbiCurSupport=window.ME_TBI_SUPPORTS[e],tbiSupportCurSize=1,tbiCurSupportKey=e,updateSupport(t)}function supportSizePlus(e){tbiSupportCurSize<tbiCurSupport.sizes&&(tbiSupportCurSize++,updateSupport(e))}function supportSizeMoins(e){tbiSupportCurSize>1&&(tbiSupportCurSize--,updateSupport(e))}function updateSupport(e){jQuery(".contentPanel").css("background-image","url(/wp-content/images/widget/tbi/"+tbiCurSupportKey+"/"+tbiCurSupport.file.replace("XXX",tbiSupportCurSize)),jQuery(e).parent().find(".curTaille").html(tbiSupportCurSize)}function displayWhiteSupport(){jQuery("#browserIFrame").add("#browserIFrameScroller").hide(),modeIframe=!1,jQuery("#meObjectContainer").empty(),jQuery("#contentPanel").css("background-image","none")}function displayWidgetSelector(){MEC_Socle.PopinHelper.openGenericHtmlPopin(jQuery("#WidgetSelectContainer"),!0,!1)}function widgetSelection(e){return document.location.href="/tbi-integration/?widget="+encodeURIComponent(e),!1}function MEUpdateWidgetGrid(){}var imageID=1;function displayImages(){switchToNavMode(jQuery("#navModeSwitcher")[0]),jQuery("#PicturesBrowser").show(),jQuery("#PictUserUploader").hide(),jQuery("#meObjectContainer #fastPictAdder").remove(),MEC_Socle.PopinHelper.openGenericHtmlPopin(jQuery("#ImageSelectContainer"),!0,!1),0==jQuery("#PicturesBrowser .tbiPictBreadcrumb").length&&buildPictureTree("/wp-content/images/widget/tbi_pictures/")}function buildPictureTree(e){for(var t=!1,i="<div class='PictureList PopinSelectListFlex'>",a=0;a<window.ME_TBI_PICTURES.length;a++)window.ME_TBI_PICTURES[a].Parent==e&&("FILE"==window.ME_TBI_PICTURES[a].Type&&-1==window.ME_TBI_PICTURES[a].URL.indexOf(".ini")?(i+="<div class='fileItem'>",i+="<img src='"+window.ME_TBI_PICTURES[a].URL+"' onclick='selectPicture(this)' onload='tbiPictPreviewLoaded(this)'",i+=" title='"+window.ME_TBI_PICTURES[a].name+"' data-savetitle='"+window.ME_TBI_PICTURES[a].name+"'/>",i+="</div>",t=!0):"FOLDER"==window.ME_TBI_PICTURES[a].Type&&(i+="<div class='folderItem' onclick='buildPictureTree(\""+window.ME_TBI_PICTURES[a].URL+"\")'>",i+="<i class='fas fa-archive'></i><span>"+window.ME_TBI_PICTURES[a].name+"</span>",i+="</div>"));"/wp-content/images/widget/tbi_pictures/"==e&&(i+="<div class='folderItem' onclick='displayUploadPictFromPC()'>",i+="<i class='fas fa-cloud-upload-alt'></i><span>Utiliser une image perso</span>",i+="</div>"),i+="</div>",jQuery("#PicturesBrowser").html(buildPictureBreadcrumb(e)+i),t&&(jQuery("#PicturesBrowser .PictureList").addClass("hasFile"),jQuery("#PicturesBrowser .PictureList .fileItem img").tooltipster({animation:"grow",theme:"tooltipster-light",delay:50,side:["right","bottom","top","left"]})),jQuery.fancybox.update()}function displayUploadPictFromPC(){jQuery("#PicturesBrowser").hide(),jQuery("#PictUserUploader").show(),jQuery("#inputPictUserUploader").val("")}function buildPictureBreadcrumb(e){var t="<div class='tbiPictBreadcrumb'>",i="/wp-content/images/widget",a=!0;folders=e.substr(i.length).split("/");for(var n=0;n<folders.length;n++)""!=folders[n]&&(t+="<div class='breadFolder' onclick='buildPictureTree(\""+(i+="/"+folders[n])+(a?"/":"")+"\")'>"+folders[n].replace("tbi_pictures","Images")+"</div>",a=!1);return t+="</div>"}function tbiPictPreviewLoaded(e){var t=e.naturalWidth,i=e.naturalHeight,a=t/i,n=i/t;t>jQuery("#meObjectContainer").width()-50&&(i=(t=jQuery("#meObjectContainer").width()-50)*n),i>jQuery("#meObjectContainer").height()-50&&(t=(i=jQuery("#meObjectContainer").height()-50)*a);var r=t<=i;jQuery(e).attr("data-natuwidth",t).attr("data-natuheight",i).attr("data-maxwidth",jQuery("#meObjectContainer").width()-50).attr("data-maxheight",jQuery("#meObjectContainer").height()-50).attr("data-addcss",r?"max-height: 100%; width: auto;":"max-width: 100%; height: auto;"),jQuery.fancybox.update()}function selectPicture(e){jQuery("#browserIFrame").add("#browserIFrameScroller").add(".textDisplContainer").hide(),modeIframe=!1,jQuery("#meWidgetDisplayer").remove();var t=jQuery(e).attr("src"),i="tbipict"+imageID,a="<div class='meTBIPict' id='"+i+"' "+("style='width:"+jQuery(e).attr("data-natuwidth")+"px; height: "+jQuery(e).attr("data-natuheight")+"px;'")+" ><img src='"+t+"' style='"+jQuery(e).attr("data-addcss")+"' /></div>";jQuery("#meObjectContainer").show().append(a),jQuery("#"+i).draggable({containment:"#meObjectContainer"}).resizable({aspectRatio:jQuery("#"+i).width()/jQuery("#"+i).height(),maxHeight:jQuery(e).attr("data-maxheight"),maxWidth:jQuery(e).attr("data-maxwidth"),handles:"e, s, se",start:function(e,t){jQuery(this).find("img").removeAttr("style")}}).append("<div class='pictureTrash' onclick='deleteTBIPict(this);'><i class='fas fa-trash'></i></div>"),imageID++,"outImage"!=e.id&&(jQuery(".fastPictAdder").show().html(jQuery("#PicturesBrowser .PictureList").clone()),jQuery(".fastPictAdder .PictureList img").each(function(){jQuery(this).attr("title",jQuery(this).attr("data-savetitle"))}),jQuery(".fastPictAdder .PictureList img").tooltipster({animation:"grow",theme:"tooltipster-light",delay:50,side:["right","bottom","top","left"]})),jQuery.fancybox.close()}function deleteTBIPict(e){jQuery(e).parent().remove()}function userImageUploaded(e){var t=(e.target||window.event.srcElement).files;if(FileReader&&t&&t.length){var i=new FileReader;i.onload=function(){document.getElementById("outImage").src=i.result},i.readAsDataURL(t[0])}}